<html>
<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"> </script>
  <link href="https://cdn.quilljs.com/1.3.4/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.4/quill.js"></script>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
  <style>
    #snow-container {
  height: 100%;
  width: 100%;
}
 #comment-container{
  float: right;
  width: 40%;
  /*height: 850px;  only for demonstration, should be removed */
  background: #ccccff;
  padding: 20px;
  margin-top: -850px;
}
#initial_editor{
  height: 100%;
  width: 100%;
}
#initial_nav{
  display:none;
}

#small-button{
  margin-bottom: 5px;
}

#reply-button{
  margin-bottom: 5px;
  margin-left: 220px;
}
#cmntfrm, #replyfrm{
  visibility: hidden;
}
    </style>
</head>
<script>
  $(document).ready(function() {
  var toolbarOptions = [
    ["bold", "italic", "underline", "strike"], // toggled buttons
    // ['blockquote'],
    [{ list: "ordered" }, { list: "bullet" }],
    [{ script: "sub" }, { script: "super" }], // superscript/subscript
    [{ indent: "-1" }, { indent: "+1" }], // outdent/indent
    [{ direction: "rtl" }], // text direction

    [{ size: ["small", false, "large", "huge"] }], // custom dropdown
    [{ header: [1, 2, 3, 4, 5, 6, false] }],

    [{ color: [] }, { background: [] }], // dropdown with defaults from theme
    [{ font: [] }],
    [{ align: [] }],

    ["clean"] // remove formatting button
  ];
  quill = new Quill("#snow-container", {
    placeholder: "Compose an epic...",
    modules: {
      toolbar: toolbarOptions
    },
    theme: "snow"
  });
var oldDelta = {"ops":[{"attributes":{"color":"#000000"},"insert":"This is sample text."}]};
quill.setContents(oldDelta);
})

function displayTitle(){
  var title_object=document.getElementById("title");
  title_object.innerHTML = document.getElementById("title_input").value;
  document.getElementById("title_input").style.display="none";
  document.getElementById("title_button").style.display="none";
}

function addReply(comm_id){
  var parent=this.parentNode;
  var new_reply=document.createElement("div");
  var reply = prompt("Enter your reply");
  /*new_reply.setAttribute("class","w3-panel w3-border-left w3-pale-red w3-border-red");
  new_reply.innerHTML=reply;
  parent.appendChild(new_reply);*/

  document.getElementById("inprply").value = reply;
  document.getElementById("com").value = comm_id;
  document.getElementById("replyfrm").submit();
  alert("submitted");
}

function addComment(){
  var parent=document.getElementById("comment-container");
  var inputCmnt= prompt("Enter your comment");
  var new_comment=document.createElement("div"); //new comment box
  var line_break=document.createElement("br");
  new_comment.setAttribute("class","w3-panel w3-border w3-border-black w3-hover-border-white");
  new_comment.innerHTML=inputCmnt;
  parent.appendChild(line_break);
  var acceptBtn = document.createElement("button");
  var rejectBtn = document.createElement("button");
  var replyBtn = document.createElement("button");
  var sp=document.createTextNode(" ");
  acceptBtn.setAttribute("class","w3-button w3-black");
  acceptBtn.setAttribute("id","small-button");
  rejectBtn.setAttribute("class","w3-button w3-black");
  rejectBtn.setAttribute("id","small-button");
  replyBtn.setAttribute("class","w3-button w3-black");
  replyBtn.setAttribute("id","reply-button");
  acceptBtn.innerHTML = "Accept";
  rejectBtn.innerHTML = "Reject";
  replyBtn.innerHTML = "Reply";
  new_comment.appendChild(line_break);
  new_comment.appendChild(acceptBtn);
  new_comment.appendChild(sp);
  new_comment.appendChild(rejectBtn);
  new_comment.appendChild(replyBtn);
  replyBtn.addEventListener("click",addReply,false);
  parent.appendChild(new_comment);

  document.getElementById("inpcmnt").value = inputCmnt;
  document.getElementById("cmntfrm").submit();
  alert("submitted");
}

function showComments(){
  content=document.getElementById("comment_button").innerHTML;
  if(content == "Show Comments")
  {
    var editor=document.getElementById("snow-container");
    editor.style.height = "850px";
    editor.style.width = "60%";
    var nav = document.getElementById("initial_nav");
    nav.setAttribute("id","comment-container");
    document.getElementById("comment_button").innerHTML= "Hide Comments"
  }
  if(content == "Hide Comments")
  {
    var editor=document.getElementById("snow-container");
    editor.style.height = "100%";
    editor.style.width = "100%";
    var nav = document.getElementById("comment-container");
    nav.setAttribute("id","initial_nav");
    document.getElementById("comment_button").innerHTML= "Show Comments"
  }
 
}

  </script>

<body>
  <input type="text" id="title_input" name="title" placeholder="Enter the title"></input>
  <button id="title_button" class="w3-button w3-black" onclick="displayTitle();">Enter</button>
  <button id="comment_button" class="w3-button w3-black" onclick="showComments();">Show Comments</button>

  <h1 id="title" align="center"></h1>

  <div>
    <div id="snow-container"></div>
    <nav id="initial_nav">
      <button class="w3-button w3-black" onclick="addComment();">Add comment</button>
      {% for i in comment %} 
      <div id={{i.commentID}} class = "w3-panel w3-border w3-border-black w3-hover-border-white">
        
        {{ i.comment }}
        <br><button class="w3-button w3-black">Accept</button>&nbsp; 
        <button class="w3-button w3-black">Reject</button>&nbsp;&nbsp;&nbsp;
        <button onclick=addReply({{i.commentID}}) class="w3-button w3-black">Reply</button>
        {% for j in replies %}
        
        {% for k in j %}

        {% if i.commentID == k.commentID %}
        <div class="w3-panel w3-border-left w3-pale-red w3-border-red">
           
           {{k.reply }}
          
        </div>

        {% endif %}
        {% endfor %}
        {% endfor %}
      </div>
   {% endfor %}
    </nav>
  </div>
  {% for doc in document %}
  <form id="cmntfrm" method="post" action="{% url 'editor' LOGIN_ID doc.docID doc.version%}">
    {% csrf_token %}
    <input id="inpcmnt" type ="text" name="input_comment">
  </form>
  {% endfor %}

  {% for doc in document %}
  <form id="replyfrm" method="post" action="{% url 'editor' LOGIN_ID doc.docID doc.version %}">
    {% csrf_token %}
    <input id="inprply" type ="text" name="input_reply">
    <input id="com" type="hidden" name="reply_com_id">
  </form>
  {% endfor %}
  </body>
</html>
